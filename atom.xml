<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>文木逝水</title>
  <subtitle>－－存在即合理－－</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://jiemoon.me/"/>
  <updated>2016-03-14T06:12:07.000Z</updated>
  <id>http://jiemoon.me/</id>
  
  <author>
    <name>Jiemoon</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Rails 中使用 ElasticSearch</title>
    <link href="http://jiemoon.me/2016/03/14/use-elasticsearch-in-rails/"/>
    <id>http://jiemoon.me/2016/03/14/use-elasticsearch-in-rails/</id>
    <published>2016-03-14T05:01:33.000Z</published>
    <updated>2016-03-14T06:12:07.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Why&quot;&gt;&lt;a href=&quot;#Why&quot; class=&quot;headerlink&quot; title=&quot;Why&quot;&gt;&lt;/a&gt;Why&lt;/h2&gt;&lt;p&gt;在实际应用中如果可以让用户快速的搜索出自己想要的内容，这将会是一个很有用的功能。那么要怎么来实现呢？&lt;/p&gt;
&lt;p&gt;像简单一点的方法可以使用 SQL 的 &lt;code&gt;LIKE&lt;/code&gt; 来实现，如&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; articles &lt;span class=&quot;keyword&quot;&gt;WHERE&lt;/span&gt; title &lt;span class=&quot;keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;%小苹果%&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但这样实现对数据量很大的表，其实是相当耗时的。而且在其它业务下，我们可以会对用户提交的搜索词，进行分词。在分词后，上面的SQL 可能就变成&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; articles &lt;span class=&quot;keyword&quot;&gt;WHERE&lt;/span&gt; title &lt;span class=&quot;keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;%小苹果%&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;%苹果%&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;%小%&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样效率肯定更低了。这时候我们可以使用 第三方的搜索程序，来减少数据库的压力，像 &lt;code&gt;elasticsearch&lt;/code&gt;，&lt;code&gt;Solr&lt;/code&gt; 等等。&lt;/p&gt;
&lt;p&gt;我们这里选择 &lt;code&gt;elasticsearch&lt;/code&gt;，具体可以看这里 &lt;a href=&quot;http://www.cnblogs.com/chowmin/articles/4629220.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Elasticsearch 与 Solr&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果还不知道 elasticsearch，请選 &lt;a href=&quot;/2016/02/14/elasticsearch-introduction&quot;&gt;ElasticSearch 入门&lt;/a&gt; &lt;/p&gt;
&lt;h2 id=&quot;安装-Gem&quot;&gt;&lt;a href=&quot;#安装-Gem&quot; class=&quot;headerlink&quot; title=&quot;安装 Gem&quot;&gt;&lt;/a&gt;安装 Gem&lt;/h2&gt;&lt;p&gt;Rails 下使用 ElasticSearch ，可以使用 &lt;a href=&quot;https://github.com/elastic/elasticsearch-rails&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;elasticsearch-rails&lt;/a&gt; 这个 Gem&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Gemfile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 搜索&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gem &lt;span class=&quot;string&quot;&gt;&#39;elasticsearch-model&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gem &lt;span class=&quot;string&quot;&gt;&#39;elasticsearch-rails&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ bundle&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;配置-Model&quot;&gt;&lt;a href=&quot;#配置-Model&quot; class=&quot;headerlink&quot; title=&quot;配置 Model&quot;&gt;&lt;/a&gt;配置 Model&lt;/h2&gt;&lt;p&gt;打开要添加搜索的 model 类，添加如下内容&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# app/models/article.rb&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;elasticsearch/model&#39;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Article&lt;/span&gt; &amp;lt; ActiveRecord::Base&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+   &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;symbol&quot;&gt;Elasticsearch:&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;:Model&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+   &lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;symbol&quot;&gt;Elasticsearch:&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;:Model&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;symbol&quot;&gt;:Callbacks&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+   settings &lt;span class=&quot;symbol&quot;&gt;index:&lt;/span&gt; &amp;#123; &lt;span class=&quot;symbol&quot;&gt;number_of_shards:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &amp;#125; &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+     mappings &lt;span class=&quot;symbol&quot;&gt;dynamic:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;false&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+       indexes &lt;span class=&quot;symbol&quot;&gt;:title&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+     &lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+   &lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;comment&quot;&gt;# Delete the previous articles index in Elasticsearch&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ Article.__elasticsearch_&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt;.client.indices.delete &lt;span class=&quot;symbol&quot;&gt;index:&lt;/span&gt; Article.index_name &lt;span class=&quot;keyword&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;comment&quot;&gt;# Create the new index with the new mapping&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ Article.__elasticsearch_&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt;.client.indices.create \\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+   &lt;span class=&quot;symbol&quot;&gt;index:&lt;/span&gt; Article.index_name,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+   &lt;span class=&quot;symbol&quot;&gt;body:&lt;/span&gt; &amp;#123; &lt;span class=&quot;symbol&quot;&gt;settings:&lt;/span&gt; Article.settings.to_hash, &lt;span class=&quot;symbol&quot;&gt;mappings:&lt;/span&gt; Article.mappings.to_hash &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ &lt;span class=&quot;comment&quot;&gt;# Index all article records from the DB to Elasticsearch&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+ Article.import &lt;span class=&quot;symbol&quot;&gt;force:&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;使用&quot;&gt;&lt;a href=&quot;#使用&quot; class=&quot;headerlink&quot; title=&quot;使用&quot;&gt;&lt;/a&gt;使用&lt;/h2&gt;&lt;p&gt;添加 &lt;strong&gt;app/controllers/search_controller.rb&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight ruby&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SearchController&lt;/span&gt; &amp;lt; ApplicationController&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;search&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; params[&lt;span class=&quot;symbol&quot;&gt;:q&lt;/span&gt;].&lt;span class=&quot;keyword&quot;&gt;nil&lt;/span&gt;?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      @result = []&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      @result = Article.search(params[&lt;span class=&quot;symbol&quot;&gt;:q&lt;/span&gt;]).paginate(&lt;span class=&quot;symbol&quot;&gt;page:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;symbol&quot;&gt;per_page:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;添加 &lt;strong&gt; app/views/search/search.html.erb&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight erb&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;h1&amp;gt;Articles Search&amp;lt;/h1&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;%=&lt;span class=&quot;ruby&quot;&gt; form_for search_path, &lt;span class=&quot;symbol&quot;&gt;method:&lt;/span&gt; &lt;span class=&quot;symbol&quot;&gt;:get&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; |f| &lt;/span&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;p&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;%=&lt;span class=&quot;ruby&quot;&gt; f.label &lt;span class=&quot;string&quot;&gt;&quot;Search for&quot;&lt;/span&gt; &lt;/span&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;%=&lt;span class=&quot;ruby&quot;&gt; text_field_tag &lt;span class=&quot;symbol&quot;&gt;:q&lt;/span&gt;, params[&lt;span class=&quot;symbol&quot;&gt;:q&lt;/span&gt;] &lt;/span&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;%=&lt;span class=&quot;ruby&quot;&gt; submit_tag &lt;span class=&quot;string&quot;&gt;&quot;Go&quot;&lt;/span&gt;, &lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;nil&lt;/span&gt; &lt;/span&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/p&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;%&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt; &lt;/span&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;ul&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;%&lt;span class=&quot;ruby&quot;&gt; @result.records.each_with_hit &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; |item, hit| &lt;/span&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;p&amp;gt;&amp;lt;%=&lt;span class=&quot;ruby&quot;&gt; item.title &lt;/span&gt;%&amp;gt;&amp;lt;/p&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;%&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;end&lt;/span&gt; &lt;/span&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;/images/elasticsearch-in-rails.png&quot; alt=&quot;运行结果&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Why&quot;&gt;&lt;a href=&quot;#Why&quot; class=&quot;headerlink&quot; title=&quot;Why&quot;&gt;&lt;/a&gt;Why&lt;/h2&gt;&lt;p&gt;在实际应用中如果可以让用户快速的搜索出自己想要的内容，这将会是一个很有用的功能。那么要怎么来实现呢？&lt;/p&gt;
&lt;p&gt;像简单一点的方法
    
    </summary>
    
    
      <category term="elasticsearch" scheme="http://jiemoon.me/tags/elasticsearch/"/>
    
      <category term="rails" scheme="http://jiemoon.me/tags/rails/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch 入门</title>
    <link href="http://jiemoon.me/2016/02/14/elasticsearch-introduction/"/>
    <id>http://jiemoon.me/2016/02/14/elasticsearch-introduction/</id>
    <published>2016-02-14T05:58:55.000Z</published>
    <updated>2016-03-14T06:10:33.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;什么是ElasticSearch？&quot;&gt;&lt;a href=&quot;#什么是ElasticSearch？&quot; class=&quot;headerlink&quot; title=&quot;什么是ElasticSearch？&quot;&gt;&lt;/a&gt;什么是ElasticSearch？&lt;/h3&gt;&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;ElasticSearch是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。&lt;/li&gt;
&lt;li&gt;Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是第二流行的企业搜索引擎。设计用于&lt;a href=&quot;http://baike.baidu.com/view/1316082.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;云计算&lt;/a&gt;中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h3&gt;&lt;h4 id=&quot;CentOS-6-6&quot;&gt;&lt;a href=&quot;#CentOS-6-6&quot; class=&quot;headerlink&quot; title=&quot;CentOS 6.6&quot;&gt;&lt;/a&gt;CentOS 6.6&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;安装 &lt;code&gt;Java&lt;/code&gt; 环境&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ yum install java-1.8.0-openjdk.x86_64&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;安装 elasticsearch&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 当前最新版本是 2.2.0，我们这边使用 rpm 来安装&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ wget https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/rpm/elasticsearch/2.2.0/elasticsearch-2.2.0.rpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ rpm -ivh elasticsearch-2.2.0.rpm&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;MacOSX&quot;&gt;&lt;a href=&quot;#MacOSX&quot; class=&quot;headerlink&quot; title=&quot;MacOSX&quot;&gt;&lt;/a&gt;MacOSX&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;jdk 可以去官网直接下载然后安装&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;安装 ElasticSearch&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ bundle install elasticsearch&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;配置&quot;&gt;&lt;a href=&quot;#配置&quot; class=&quot;headerlink&quot; title=&quot;配置&quot;&gt;&lt;/a&gt;配置&lt;/h3&gt;&lt;p&gt;如果是 &lt;code&gt;MacOSX&lt;/code&gt; 系统，则相对比较简单。由于服务器使用的是 &lt;code&gt;CentOS 6.6&lt;/code&gt;，因此着重介绍 &lt;code&gt;CentOS&lt;/code&gt; 下的配置&lt;/p&gt;
&lt;p&gt;安装成功后，会在 /etc/elasticsearch 生成两个配置文件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;elasticsearch.yml - Elasticsearch 服务配置文件&lt;/li&gt;
&lt;li&gt;logging.yml 日志配置文件&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;打开 /etc/elasticsearch/elasticsearch.yml，对文件中的如下项进行修改，记得要去掉前面的 &lt;code&gt;#&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight yml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cluster.name: my-cluster &lt;span class=&quot;comment&quot;&gt;# 集群名称&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.name: my-node &lt;span class=&quot;comment&quot;&gt;# 节点名称&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;path.data: /xxx/elasticsearch/data &lt;span class=&quot;comment&quot;&gt;# 数据存放路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;path.logs: /xxx/elasticsearch/logs &lt;span class=&quot;comment&quot;&gt;# 日志存放路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;network.host: &lt;span class=&quot;number&quot;&gt;127.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# 只允许本机访问&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改后，保存。启动 elasticsearch 服务&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;service elasticsearch start&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此外，我们可以把 &lt;code&gt;elasticsearch&lt;/code&gt; 设置为开机自启动&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ chkconfig --add elasticsearch&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;测试&quot;&gt;&lt;a href=&quot;#测试&quot; class=&quot;headerlink&quot; title=&quot;测试&quot;&gt;&lt;/a&gt;测试&lt;/h3&gt;&lt;p&gt;访问 &lt;a href=&quot;http://localhost:9200&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://localhost:9200&lt;/a&gt; ，如果出现如下响应，则服务运行成功。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bash-4.1&lt;span class=&quot;comment&quot;&gt;# curl -X GET &#39;http://localhost:9200&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;my-node&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;cluster_name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;my-cluster&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;number&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;2.2.0&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_hash&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;8ff36d139e16f8720f2947ef62c8167a888992fe&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_timestamp&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;2016-01-27T13:32:39Z&quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_snapshot&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;lucene_version&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;5.4.1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;tagline&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;You Know, for Search&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;使用&quot;&gt;&lt;a href=&quot;#使用&quot; class=&quot;headerlink&quot; title=&quot;使用&quot;&gt;&lt;/a&gt;使用&lt;/h3&gt;&lt;h4 id=&quot;添加记录&quot;&gt;&lt;a href=&quot;#添加记录&quot; class=&quot;headerlink&quot; title=&quot;添加记录&quot;&gt;&lt;/a&gt;添加记录&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X POST &lt;span class=&quot;string&quot;&gt;&#39;http://localhost:9200/tutorial/helloworld/1&#39;&lt;/span&gt; &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123; &quot;message&quot;: &quot;Hello World!&quot; &amp;#125;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;返回&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _index: &quot;tutorial&quot;, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _type: &quot;helloworld&quot;, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _id: &quot;1&quot;, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _version: 1, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  _shards: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    total: 2, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    successful: 1, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    failed: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;, &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  created: true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;tutorial is the index of the data in Elasticsearch.&lt;/li&gt;
&lt;li&gt;helloworld is the type.&lt;/li&gt;
&lt;li&gt;1 is the id of our entry under the above index and type.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;获取记录&quot;&gt;&lt;a href=&quot;#获取记录&quot; class=&quot;headerlink&quot; title=&quot;获取记录&quot;&gt;&lt;/a&gt;获取记录&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X GET &amp;apos;http://localhost:9200/tutorial/helloworld/1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;修改记录&quot;&gt;&lt;a href=&quot;#修改记录&quot; class=&quot;headerlink&quot; title=&quot;修改记录&quot;&gt;&lt;/a&gt;修改记录&lt;/h4&gt;&lt;p&gt;如果要修改已经存在的实体，可以使用 HTTP PUT  请求：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X PUT &amp;apos;localhost:9200/tutorial/helloworld/1?pretty&amp;apos; -d &amp;apos;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;message&amp;quot;: &amp;quot;Hello People!&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;更新成功后返回：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;_index&amp;quot; : &amp;quot;tutorial&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;_type&amp;quot; : &amp;quot;helloworld&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;_id&amp;quot; : &amp;quot;1&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;_version&amp;quot; : 2,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;_shards&amp;quot; : &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;total&amp;quot; : 2,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;successful&amp;quot; : 1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;failed&amp;quot; : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;quot;created&amp;quot; : false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;其中 &lt;code&gt;_version&lt;/code&gt; 会自增（+1），从 1 变成 2&lt;/p&gt;
&lt;h4 id=&quot;删除记录&quot;&gt;&lt;a href=&quot;#删除记录&quot; class=&quot;headerlink&quot; title=&quot;删除记录&quot;&gt;&lt;/a&gt;删除记录&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X DELETE &lt;span class=&quot;string&quot;&gt;&#39;localhost:9200/tutorial/helloworld/1?pretty&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;遇到的问题&quot;&gt;&lt;a href=&quot;#遇到的问题&quot; class=&quot;headerlink&quot; title=&quot;遇到的问题&quot;&gt;&lt;/a&gt;遇到的问题&lt;/h3&gt;&lt;h4 id=&quot;错误1&quot;&gt;&lt;a href=&quot;#错误1&quot; class=&quot;headerlink&quot; title=&quot;错误1&quot;&gt;&lt;/a&gt;错误1&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bash-4.1# service elasticsearch start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Starting elasticsearch: log4j:ERROR setFile(null,true) call failed.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;java.io.FileNotFoundException: /xxx/elasticsearch/logs/my-cluster.log (Permission denied)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  at java.io.FileOutputStream.open0(Native Method)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  at java.io.FileOutputStream.open(FileOutputStream.java:270)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;根据 &lt;a href=&quot;https://discuss.elastic.co/t/elasticsearch-unable-to-start/23824/5&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://discuss.elastic.co/t/elasticsearch-unable-to-start/23824/5&lt;/a&gt;的提示&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Ok so that will have installed the rpm package for Elasticsearch. It will have created an elasticsearch user on your linux OS and when you start the Elasticsearch service it will be running as the elasticsearch user. The problem you are encountering will be that the elasticsearch user does not have permission to write to /var/log/elasticsearch or the files inside it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;使用 &lt;code&gt;rpm&lt;/code&gt; 安装的话，会使用 &lt;code&gt;elasticsearch&lt;/code&gt; 这个用户来运行 elasticsearch，因此要修改下  &lt;code&gt;/xxx/elasticsearch&lt;/code&gt; 的用户组&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ chmod -R  elasticsearch /xxx/elasticsearch&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;错误2&quot;&gt;&lt;a href=&quot;#错误2&quot; class=&quot;headerlink&quot; title=&quot;错误2&quot;&gt;&lt;/a&gt;错误2&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bash-4.1&lt;span class=&quot;comment&quot;&gt;# service elasticsearch start&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Starting elasticsearch:                                    [  OK  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bash-4.1&lt;span class=&quot;comment&quot;&gt;# Exception in thread &quot;main&quot; BindTransportException[Failed to bind to [9300-9400]]; nested: ChannelException[Failed to bind to: localhost/35.127.0.0:9400]; nested: BindException[Cannot assign requested address];&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;把  &lt;code&gt;/ect/elasticsearch/elasticsearch.yml&lt;/code&gt; 里的 localhost -&amp;gt; 127.0.0.1 后&lt;/p&gt;
&lt;figure class=&quot;highlight yml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;network.host: &lt;span class=&quot;number&quot;&gt;127.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;重新启动，不再报错&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;什么是ElasticSearch？&quot;&gt;&lt;a href=&quot;#什么是ElasticSearch？&quot; class=&quot;headerlink&quot; title=&quot;什么是ElasticSearch？&quot;&gt;&lt;/a&gt;什么是ElasticSearch？&lt;/h3&gt;&lt;blockquote&gt;

    
    </summary>
    
    
      <category term="elasticsearch" scheme="http://jiemoon.me/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Git 日记：如何更新 fork 过来的项目</title>
    <link href="http://jiemoon.me/2015/12/31/how-to-update-git-project-from-fork/"/>
    <id>http://jiemoon.me/2015/12/31/how-to-update-git-project-from-fork/</id>
    <published>2015-12-31T06:49:13.000Z</published>
    <updated>2016-03-14T06:18:05.000Z</updated>
    
    <content type="html">&lt;p&gt;当我们把别人的项目 &lt;code&gt;fork&lt;/code&gt; 过来后，当源更新后，我们要怎样才能更新自己 fork 过来的项目呢？是要重新 &lt;code&gt;fork&lt;/code&gt;，这当然可以，但有更好的方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;在 &lt;code&gt;fork&lt;/code&gt; 的代码库中添加上游代码库的 remote 源，该操作只需操作一次即可。&lt;br&gt;如: 其中 &lt;code&gt;{upstream}&lt;/code&gt; 表示上游代码库名，可以任意命名。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git remote add &amp;#123;upstream&amp;#125; git@github.com:soimort/you-get.git&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;将本地的修改提交 commit&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在每次 Pull Request 前做如下操作，即可实现和上游版本库的同步&lt;br&gt;3.1 ： &lt;code&gt;git remote update upstream&lt;/code&gt;&lt;br&gt;3.2 ： &lt;code&gt;git rebase upstream/{branch name}&lt;/code&gt;&lt;br&gt;需要注意的是在操作 3.2 之前，一定要将 &lt;code&gt;checkout&lt;/code&gt; 到 &lt;code&gt;{branch name}&lt;/code&gt; 所指定的 &lt;code&gt;branch&lt;/code&gt;&lt;br&gt;如: &lt;code&gt;git checkout develop&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Push 代码到 Github&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git push origin develop&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;参考: &lt;a href=&quot;http://www.oschina.net/question/118031_129007&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.oschina.net/question/118031_129007&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;当我们把别人的项目 &lt;code&gt;fork&lt;/code&gt; 过来后，当源更新后，我们要怎样才能更新自己 fork 过来的项目呢？是要重新 &lt;code&gt;fork&lt;/code&gt;，这当然可以，但有更好的方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;在 &lt;code&gt;fork&lt;/code&gt; 的
    
    </summary>
    
    
      <category term="git" scheme="http://jiemoon.me/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>使用 GoAccess 分析 Nginx 访问日志</title>
    <link href="http://jiemoon.me/2015/11/14/goaccess-analysis-nginx-access-log/"/>
    <id>http://jiemoon.me/2015/11/14/goaccess-analysis-nginx-access-log/</id>
    <published>2015-11-14T05:52:15.000Z</published>
    <updated>2016-03-14T06:16:29.000Z</updated>
    
    <content type="html">&lt;p&gt;&lt;img src=&quot;/images/goaccess.png&quot; alt=&quot;GoAccess&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;安装-GoAccess&quot;&gt;&lt;a href=&quot;#安装-GoAccess&quot; class=&quot;headerlink&quot; title=&quot;安装 GoAccess&quot;&gt;&lt;/a&gt;安装 GoAccess&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://www.goaccess.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.goaccess.io&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Mac 下安装&lt;/strong&gt;  &lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;brew install goaccess&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其它平台可以参考官网上的教程&lt;a href=&quot;http://www.goaccess.io/download&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.goaccess.io/download&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;配置-goaccessrc&quot;&gt;&lt;a href=&quot;#配置-goaccessrc&quot; class=&quot;headerlink&quot; title=&quot;配置 goaccessrc&quot;&gt;&lt;/a&gt;配置 goaccessrc&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;vim ~/.goaccessrc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在 &lt;code&gt;.goaccessrc&lt;/code&gt; 添加如下内容&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;time-format %H:%M:%S&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;date-format %d/%b/%Y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;-format %h %^ %^ %^[%d:%t %^] &lt;span class=&quot;string&quot;&gt;&quot;%r&quot;&lt;/span&gt; %s %b &lt;span class=&quot;string&quot;&gt;&quot;%R&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;%u&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;%D&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;%T&quot;&lt;/span&gt; %^&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;$^&lt;/code&gt; 表示忽略这个字段&lt;/p&gt;
&lt;p&gt;上面的 配置是根据 nginx 里日志的格式来定义的，我 nginx 的日志格式为&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;apos;&amp;apos;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; \ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;apos;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$request_time&amp;quot; &amp;quot;$upstream_response_time&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;分析-Nginx-访问日志&quot;&gt;&lt;a href=&quot;#分析-Nginx-访问日志&quot; class=&quot;headerlink&quot; title=&quot;分析 Nginx 访问日志&quot;&gt;&lt;/a&gt;分析 Nginx 访问日志&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;goaccess -q --no-query-string &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt; www.example.com.access.log &lt;span class=&quot;_&quot;&gt;-a&lt;/span&gt; -p ~/.goaccessrc &amp;gt; report.html&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;-q --no-query-string&lt;/code&gt; 忽略请求的参数部分，再统计接口的访问量时可以使用这个参数&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/goaccess.png&quot; alt=&quot;GoAccess&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;安装-GoAccess&quot;&gt;&lt;a href=&quot;#安装-GoAccess&quot; class=&quot;headerlink&quot; title=&quot;安装 GoAccess&quot;&gt;&lt;/
    
    </summary>
    
    
      <category term="nginx" scheme="http://jiemoon.me/tags/nginx/"/>
    
      <category term="goaccess" scheme="http://jiemoon.me/tags/goaccess/"/>
    
  </entry>
  
  <entry>
    <title>Linux 服务器内存使用分析</title>
    <link href="http://jiemoon.me/2015/10/14/linux-server-memory-usage-analysis/"/>
    <id>http://jiemoon.me/2015/10/14/linux-server-memory-usage-analysis/</id>
    <published>2015-10-14T05:15:00.000Z</published>
    <updated>2016-03-14T06:13:03.000Z</updated>
    
    <content type="html">&lt;p&gt;运行在 Linux 上的应用程序大部分都是需要占用内存，像 web 服务器（nginx\apache）, Rails 程序 ，php-fpm 等等。如果服务器上可用的内存不够，就会出现部分程序会启动不起来，或者有些程序会被系统 kill 掉。&lt;/p&gt;
&lt;p&gt;我们可以通过以下命令，查询出哪些程序占用的内存比较多，如果有些是无用的进程，则手动把它 kill 掉。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;查看占用内存最多的程序（前10）&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ps aux | sort -k4,4nr | head -n 10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;可以查看占用总内存的比率&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ps -eo pmem,pcpu,vsize,pid,cmd | sort -k 1 -nr | head -15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;查看服务器内存的使用情况&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;free -m&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者，如果没有可以 kill 的进程，这时候就要考虑是不是要增加服务器的内存。&lt;/p&gt;
&lt;p&gt;另，系统内存和应用使用内存的区别：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/linux-system-app-mem.png&quot; alt=&quot;系统内存和应用使用内存的区别&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/linux-cache-buffer.png&quot; alt=&quot;Cache 和 Buffer&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;运行在 Linux 上的应用程序大部分都是需要占用内存，像 web 服务器（nginx\apache）, Rails 程序 ，php-fpm 等等。如果服务器上可用的内存不够，就会出现部分程序会启动不起来，或者有些程序会被系统 kill 掉。&lt;/p&gt;
&lt;p&gt;我们可以通过以下
    
    </summary>
    
    
      <category term="linux" scheme="http://jiemoon.me/tags/linux/"/>
    
  </entry>
  
</feed>
